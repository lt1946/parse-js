/**//**//**//**//**//**//*  
**  ==================================================================================================  
**  类名：J.highlight
**	版本：1.0
**  功能：语法高亮  
**  示例：  
    ---------------------------------------------------------------------------------------------------  
	
		用法：J.highlight.init();
			  <textarea class="lang-js">js代码</textarea>
		
    ---------------------------------------------------------------------------------------------------  
**  作者：zjfeihu
**  邮件：zjfeihu@126.com 
**  创建：2011/08/03
**  更新：2011/08/27
**	组件地址：http://www.1kjs.com/lib/widget/highlight/
**  ==================================================================================================  
**/!function(h){var y={'default':{js:{hlbox:'padding:4px 8px;background:#f5f8fa;color:#333;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;border:1px solid #3C78B5;border-left:4px solid #3C78B5;line-height:1.5;',li:'list-style:none;',unit:{keyword:'color:#0000C6;',userword:'color:#e59c38;',comment:'color:#B0812C;',quote:'color:#666666;',number:'color:red;',brackets:'color:#333;',regexp:'color:#008074;'}},html:{hlbox:'padding:4px 8px;background:#f5f8fa;color:#333;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;border:1px solid #3C78B5;border-left:4px solid #3C78B5;line-height:1.5;',li:'list-style:none;',unit:{tag:'color:#0000C6;',comment:'color:#B0812C;',attrval:'color:#666;',attrkey:'color:red;',doctype:'color:#008074;'}},css:{hlbox:'padding:4px 8px;background:#f5f8fa;color:#333;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;border:1px solid #3C78B5;border-left:4px solid #3C78B5;line-height:1.5;',li:'list-style:none;',unit:{csssel:'color:#008074;',csskey:'color:red;',comment:'color:#B0812C;',cssval:'color:#666;'}}},black:{js:{hlbox:'padding:2px 0 2px 52px;background:#060606;color:#eee;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;line-height:1.5;',li:'background:#222;padding:0 0 0 5px;border-left:1px solid #333;',unit:{keyword:'color:#119BEE;',userword:'color:#FFCC00;',comment:'color:#666;',quote:'color:#89D726;',number:'color:#86CC99;',brackets:'color:#B7B700;',regexp:'color:#FE81F8;'}},html:{hlbox:'padding:2px 0 2px 52px;background:#060606;color:#eee;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;line-height:1.5;',li:'background:#222;padding:0 0 0 5px;border-left:1px solid #333;',unit:{tag:'color:#119BEE;',comment:'color:#666;',attrval:'color:#89D726;',attrkey:'color:#86CC99;',doctype:'color:#B7B700;'}},css:{hlbox:'padding:2px 0 2px 52px;background:#060606;color:#eee;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;line-height:1.5;',li:'background:#222;padding:0 0 0 5px;border-left:1px solid #333;',unit:{csssel:'color:#FE81F8;',csskey:'color:#119BEE;',comment:'color:#666;',cssval:'color:#89D726;'}}},bop:{js:{hlbox:'padding:2px 0 2px 52px;background:#060606;color:#eee;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;line-height:1.5;',li:'background:#222;padding:0 0 0 5px;border-left:1px solid #333;',unit:{keyword:'color:#ef5d32;',userword:'color:#ef5d32;',comment:'color:#808000;',quote:'color:#d9d762;',number:'color:#6c99bb;',brackets:'color:#e6e1c4;',regexp:'color:#8856d2;'}},html:{hlbox:'padding:2px 0 2px 52px;background:#060606;color:#eee;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;line-height:1.5;',li:'background:#222;padding:0 0 0 5px;border-left:1px solid #333;',unit:{tag:'color:#efac32;',comment:'color:#B0812C;',attrval:'color:#d9d762;',attrkey:'color:#6c99bb;',doctype:'color:#efac32;'}},css:{hlbox:'padding:2px 0 2px 52px;background:#060606;color:#eee;font-family:monaco,verdana,Helvetica,Tahoma,Arial,sans-serif;line-height:1.5;',li:'background:#222;padding:0 0 0 5px;border-left:1px solid #333;',unit:{csssel:'color:#efac32;',csskey:'color:#c0c0c0;',comment:'color:#666;',cssval:'color:#d9d762;'}}}},i={'&':{reg:/&/g,to:'&amp;'},'<':{reg:/</g,to:'&lt;'},' ':{reg:/ /g,to:'&nbsp;'},'\t':{reg:/\t/g,to:'&nbsp;&nbsp;&nbsp;&nbsp;'},'\n':{reg:/\n/g,to:'</li><li>'}},z={beskip:{cls:'#',reg:/(\$[\w]*)/},regexp:[{contains:{brackets:{cls:'brackets',reg:/(\[|\()/},keyword:{cls:'keyword',reg:/(typeof|void|return|in|throw|case)/},cop:{cls:'#',reg:/(^|[-~:=?,!>]|\/\s+)/},cop2:{reg:/(<)/,restr:[i['<']]}}},{unneed:1,contains:{sstr:{reg:/\s/,restr:[i[' '],i['\t'],i['\n']]},comment:{cls:'comment',reg:/(?:\/\/.*\s|\/\*[\w\W]*?\*\/)/,restr:[i['&'],i['<'],i[' '],i['\t'],{reg:/\n/g,to:'</span></li><li><span class="comment">'}]}}},{contains:{regexp:{cls:'regexp',reg:/(\/(?:\\\\|\\\/|\[.+?\]|[^\/\r\n])+\/[gim]*)/,restr:[i['&'],i['<'],i[' '],i['\t']]}}}],comment:{cls:'comment',reg:/(\/\*[\w\W]*?\*\/|\/\/.*)/,restr:[i['&'],i['<'],i[' '],i['\t'],{reg:/\n/g,to:'</span></li><li><span class="comment">'}]},quote:{cls:'quote',reg:/("(?:\\\\|\\"|[^"\r])*"|'(?:\\\\|\\'|[^'\r])*')/,restr:[i['&'],i['<'],i[' '],i['\t'],{reg:/\n/g,to:'</span></li><li><span class="quote">'}]},keyword:{cls:'keyword',reg:/(boolean|break|byte|case|catch|char|class|const|continue|default|double|do|else|extends|false|finally|final|float|for|function|goto|if|implements|import|instanceof|interface|int|in|long|native|new|null|package|private|protected|public|return|short|static|super|switch|synchronized|typeof|this|throw|throws|transient|true|try|var|void|while|with)(?![\w$])/},userword:{cls:'userword',reg:/(window|document|Math|Boolean)(?![\w$])/},id:{cls:'#',reg:/([a-zA-Z_]+[\w]*)/},number:{cls:'number',reg:/(0x[0-9a-fA-F]+|(?:\d+\.\d*|\d*\.\d+|\d+)(?:[eE][+\-]?\d+)?)/},brackets:{cls:'brackets',reg:/([(){}\[\]]+)/},cstr:{cls:'#',reg:/(\s+|<|&)/,restr:[i['&'],i['<'],i[' '],i['\t'],{reg:/\n/g,to:'</li><li>'}]}},w,t,A=/(<script[^>]*?>[\s\S]*?<\/script>)|(<style[^>]*?>[\s\S]*?<\/style>)|(<textarea[^>]*?>[\s\S]*?<\/textarea>)|(<[\w]+[^>]*?>|<\/[\w]+>)|(<!--[\s\S]*?-->)|(<!doctype[^>]*?>)|(\n)|(\t)|(\s)/gi,o,p,x=[],k={init:function(a){a=a||{};k._skin=a.skin||'default';k._line=a.line==false?false:true;k._eidt=a.eidt==false?false:true;k._loadSkin();k._formatReg();h.ready(function(){k._ccMenu();k._doHighlight();k._ccDemoWin()})},_JsRequire:function(a){a=a.split(',');h.each(a,function(){x.push('<script src="'+this+'"></script>')})},parseCss:function(q,B){q=q.replace(/(\{[^\}]*\})|(\/\*[\w\W]*?\*\/)|(\n)|([^\n\{\}]+)/g,function(j,l,n,m,r,u,v){switch(!1){case!l:return j.replace(/([^{\n;]+?:[^}\n;]+)|(\n)|(\/\*[\w\W]*?\*\/)|( )/g,function(a,c,d,b,f){switch(!1){case!c:var g=c.split(':')[0],e=c.split(':')[1];return'<span class="csskey">'+s(g)+'</span>:<span class="cssval">'+e+'</span>';case!d:return'</li><li>';case!b:return'<span class="comment">'+s(b)+'</span>';case!f:return'&nbsp;'}});case!n:return'<span class="comment">'+s(n)+'</span>';case!m:return'</li><li>';case!r:return r.replace(/(\/\*[\w\W]*?\*\/)|( )|(\t)|([^{]+)/g,function(a,c,d,b,f){if(c){return'<span class="comment">'+s(c)+'</span>'}else if(d){return'&nbsp;'}else if(b){return'&nbsp;&nbsp;&nbsp;&nbsp;'}else if(f){return'<span class="csssel">'+f+'</span>'}})}});return'<ol class="'+(B||k._skin)+'-hlcss"><li>'+q+'</li></ol>';function s(a){return a.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/\t/g,'&nbsp;&nbsp;&nbsp;&nbsp;').replace(/\s/g,'&nbsp;').replace(/</g,'&lt;')}},parseHtml:function(g,e){var j=this;g=g.replace(A,function(f){switch(!1){case!arguments[1]:return f.replace(/(<script[^>]*?>)([\s\S]*?)(<\/script>)/,function(a,c,d,b){return l(c)+j.parseJs(d,e).replace(/<ol[^>]+><li>|<\/li><\/ol>/g,'')+n(b)});case!arguments[2]:return f.replace(/(<style[^>]*?>)([\s\S]*?)(<\/style>)/,function(a,c,d,b){return l(c)+j.parseCss(d,e).replace(/<ol[^>]+><li>|<\/li><\/ol>/g,'')+n(b)});case!arguments[3]:return f.replace(/(<textarea[^>]*?>)([\s\S]*?)(<\/textarea>)/,function(a,c,d,b){return l(c)+m(d)+n(b)});case!arguments[4]:return l(f);case!arguments[5]:return'<span class="comment">'+m(f)+'</span>';case!arguments[6]:return'<span class="doctype">'+m(f)+'</span>';case!arguments[7]:return'</li><li>';case!arguments[8]:return'&nbsp;&nbsp;&nbsp;&nbsp;';case!arguments[9]:return'&nbsp;'}});e=e||j._skin;return'<ol class="'+[e+'-hlhtml',e+'-hljs',e+'-hlcss'].join(' ')+'"><li>'+g+'</li></ol>';function l(b){return'<span class="tag">'+b.replace('<','&lt;').replace('>','&gt;').replace(/(\w+=)('[\s\S]*?'|"[\s\S]*?")/g,function(a,c,d){return'<span class="attrkey">'+c+'</span><span class="attrval">'+d+'</span>'})+'</span>'}function n(a){return'<span class="tag">'+a.replace('<','&lt;').replace('>','&gt;')+'</span>'}function m(a){return a.replace(/&/g,'&amp;').replace(/</g,'&lt;')}},parseJs:function(l,n){var m=t.length;l=l.replace(w,function(){var b=0,f=[];while(b++<m){if(arguments[b]){var g=arguments[b],e=t[b-1];if(e.length){for(var j=0;j<e.length;j++){g=g.replace(e[j].reg,function(a){var c=e[j];if(c.restr){for(var d=0;d<c.restr.length;d++){a=a.replace(c.restr[d].reg,c.restr[d].to)}}if(c.cls){a='<span class="'+c.cls+'">'+a+'</span>'}return a})}f.push(g);continue}else{if(e.restr){for(var j=0;j<e.restr.length;j++){g=g.replace(e.restr[j].reg,e.restr[j].to)}}if(e.cls){g='<span class="'+e.cls+'">'+g+'</span>'}f.push(g)}}}return f.join('')});return'<ol class="'+(n||k._skin)+'-hljs"><li>'+l+'</li></ol>'},_doHighlight:function(){h('textarea')&&h('textarea').each(function(){var b=this.cls('lang-js')?'Js':this.cls('lang-html')?'Html':this.cls('lang-css')?'Css':0;if(b){var f=function(c){var d=Array(50).join(' ');c=c.replace(/\t/g,'    ').replace(/\s+$/,'');if(!/^\S/m.test(c)){c.replace(/^\s+/gm,function(a){if(a.length<d.length)d=a});c=c.replace(new RegExp('^'+d,'gm'),'')}return c}(this.node.value);var g=this.attr('skin');if(!k._eidt||b=='Css'){this.replace(h.node('<div class="hlwrap"><div class="hlcode">'+k['parse'+b](f,g)+'</div></div>'))}else{var e=h.node('<div class="hlwrap"><div class="hledit"><textarea>'+f+'</textarea><div class="btnbox"><button>\u52A0\u4EAE\u4EE3\u7801</button><button>\u6267\u884C\u4EE3\u7801</button><span>\u63D0\u793A\uFF1A\u4F60\u53EF\u4EE5\u5148\u4FEE\u6539\u4EE3\u7801\u518D\u6267\u884C\u64CD\u4F5C\uFF01</span></div></div><div class="hlcode">'+k['parse'+b](f,g)+'</div></div>');this.replace(e);var j=e.child(1).on('contextmenu',function(a){o.left(a.clientX+4);o.top(a.clientY+h.scrollTop()+4);e.type=b;e.skin=g;p=e;a.preventDefault();a.stopPropagation()}),l=e.child(0).find('textarea');e.find('button').each(function(a){this.click(function(){if(a){p=e;k._toRun()}else{j.html(k['parse'+b](l.node.value,p.skin));e.cls('hlwrap','hlwrap-edit')}})})}}})},_loadSkin:function(){var f=[];h.each(y,function(b){h.each(this,function(c){var d='.'+b+'-hl'+c;f.push(d+'{'+this['hlbox']+'margin:0;word-wrap:break-word;word-break:break-all;display:inline-block\9;font-size:14px;}');f.push(d+' li{margin:0;'+this['li']+'}');h.each(this.unit,function(a){f.push([d+' .',a,'{',this,'}'].join(''))})})});f.push(['.hlmenu{','position:absolute;','background:#FFFFFF;','border:1px solid #999999;','font-size:12px;','top:0;','left:-999px;','padding:1px;','width:100px;','}','.hlmenu a{display:block;padding:3px 12px;color:#333;text-decoration:none!important;}','.hlmenu a:hover{background:#316AC5;color:#fff;}'].join(''));f.push(['.hlwrap,.hlwrap-edit{}','.hledit{border:1px solid #999999;margin: 3px;overflow:hidden;padding:3px;font-size:12px;}','.hledit textarea{font:14px/1.5 Monaco,"Lucida Console","Consolas","Courier New",Courier,mono,serif;					border:0;					height:190px;					display:block;					width:100%;					resize: none;					outline: none;\}','.hledit .btnbox{border-top:1px solid #999;padding-top:3px;}','.hledit button{padding:0 6px;}','.hlwrap .hledit{display:none;}','.hlwrap-edit{border:1px solid #999;background:#eee;}','.hlwrap-edit .hlcode{display:none;}','.hlwrap-edit .hledit{display:block;background:#fff;}','.hlwrap-edit span{color:green;padding-left:1em;}'].join(''));f.push(['.hldemowin{z-index:9999;display:none;position:fixed;_position:absolute;left:0;top:0;width:100%;height:400px;background:#fff;}','.hldemowin .closebar{margin:3px auto;width:400px;padding:8px;font-size:14px;font-weight:bold;cursor:pointer;text-align:center;background:#fefefe;border:1px solid #999;color:red;}','.hldemowin .closebar:hover{background:#feefff;}','.hldemowin iframe{border-top:1px solid #000}'].join(''));h.css(f.join(''))},_ccMenu:function(){var c=this;o=h.node('<div class="hlmenu"><a href="#" jbtn="edit">\u7F16\u8F91\u4EE3\u7801</a><a href="#" jbtn="run">\u8FD0\u884C\u4EE3\u7801</a><a href="http://www.1kjs.com/lib/widget/highlight/" target="_blank">\u5173\u4E8E\u63D2\u4EF6</a></div>');h('body').append(o);o.click(function(a){o.left(-999);switch(h(a.target).attr('jbtn')){case'edit':c._toEdit();break;case'run':c._toRun();break;default:return}a.preventDefault();a.stopPropagation()}).on('contextmenu',function(a){a.preventDefault()});h(document).click(function(a){if(!o.contains(a.target)){o.left(-999)}})},_toEdit:function(){p.cls('hlwrap-edit','hlwrap');h.scrollTop(p.offsetTop()-120,1000)},_toRun:function(){var a=p.type;if(a=='Js'){this.demoWin.js(p.find('textarea').node.value)}else if(a=='Html'){this.demoWin.html(p.find('textarea').node.value)}},_formatReg:function(){var v=q(z);w=RegExp(v.reg,'g');t=v.setting;function q(a){var c=[],d=[],b;for(var f in a){b=a[f];if(b.reg){if(b.restr||b.cls){d.push({cls:b.cls&&b.cls!='#'?b.cls:'',restr:b.restr})}c.push(b.reg.source)}else if(b.length){var g,e=[];for(var j=0;j<b.length;j++){g=b[j];if(g.unneed){g=g.contains;var l=[],n=[],m;for(var r in g){m=g[r];l.push(m.reg.source);n.push({reg:RegExp(m.reg.source,'g'),cls:m.cls&&m.cls!='#'?m.cls:'',restr:m.restr})}e.push('((?:'+l.join('|')+')*)');d.push(n)}else{var u=q(g.contains);e.push(u.reg);d=d.concat(u.setting)}}c.push('(?:'+e.join('')+')')}}return{reg:'(?:'+c.join('|')+')',setting:d}}},_ccDemoWin:function(){var d=h.node('<div class="hldemowin"><div class="closebar">\u70B9\u51FB\u5173\u95ED</div></div>'),b,f,g=0;h('body').append(d.node);this.demoWin={js:function(a){b&&b.node.parentNode.removeChild(b.node);b=h.node('<iframe src="#" name="demoWin" frameborder="0" width="100%"></iframe>');d.append(b.node);var c=window.open('','demoWin');c.document.write(x.join(''));c.document.write('<script>'+a+'</script>');c.document.close()},html:function(a){b&&b.node.parentNode.removeChild(b.node);b=h.node('<iframe src="#" name="demoWin" frameborder="0" width="100%"></iframe>');d.append(b.node);f=document.documentElement.scrollTop+document.body.scrollTop;h('html').css('overflow','hidden');g=1;e();d.show();var c=window.open('','demoWin');c.document.write(a);c.document.close()}};function e(){if(g){d.css({width:document.documentElement.clientWidth,height:document.documentElement.clientHeight});b.height(document.documentElement.clientHeight-40)}}function j(a){return a.replace(/\\/g,'\\\\').replace(/'/g,'\\\'').replace(/%/g,'%25').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}h(window).on('resize',e);d.child(0).click(function(){h('html').css('overflow','');document.documentElement.scrollTop=f;document.body.scrollTop=f;d.hide();b.node.parentNode.removeChild(b.node);b=null;g=0})}};h.widget('highlight',function(){return k})}($1k);;
